<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Detection Logs</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container mt-4">
    <h2>Detection Logs</h2>
    <a href="/" class="btn btn-outline-secondary mb-3">â¬… Back</a>

    <div class="mb-3">
      <button id="deleteSelected" class="btn btn-danger">Delete Selected</button>
      <button id="selectAll" class="btn btn-sm btn-outline-primary ms-2">Select All</button>
      <button id="clearSelection" class="btn btn-sm btn-outline-secondary ms-1">Clear</button>
    </div>

    <form id="logsForm">
      <table class="table table-striped">
        <thead>
          <tr>
            <th></th>
            <th>ID</th>
            <th>Timestamp</th>
            <th>Result</th>
            <th>Snapshot</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          {% for row in data %}
          <tr>
            <td><input type="checkbox" class="row-check" data-id="{{ row[0] }}"></td>
            <td>{{ row[0] }}</td>
            <td>{{ row[1] }}</td>
            <td>{{ row[2] }}</td>
            <td><img src="/{{ row[3] }}" width="160"></td>
            <td>
              <form method="post" action="{{ url_for('delete_log', rowid=row[0]) }}" style="display:inline;">
                <button class="btn btn-sm btn-danger" type="submit">Delete</button>
              </form>
            </td>
          </tr>
          {% else %}
          <tr><td colspan="6">No logs yet</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </form>
  </div>

  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script>
    $(function(){
      $('#selectAll').click(function(){
        $('.row-check').prop('checked', true);
      });
      $('#clearSelection').click(function(){
        $('.row-check').prop('checked', false);
      });

      $('#deleteSelected').click(function(){
        const ids = $('.row-check:checked').map(function(){ return $(this).data('id'); }).get();
        if(ids.length === 0){
          alert('Select at least one row to delete.');
          return;
        }
        if(!confirm('Delete selected ' + ids.length + ' items permanently?')) return;
        fetch('/delete_multiple', {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({ids: ids})
        }).then(r => r.json()).then(resp => {
          if(resp.status === 'ok'){
            location.reload();
          } else {
            alert('Delete failed');
          }
        }).catch(e => alert('Error: ' + e));
      });
    });
  </script>
</body>
</html>
